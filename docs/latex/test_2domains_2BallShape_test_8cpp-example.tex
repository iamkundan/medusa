\doxysection{test/domains/\+Ball\+Shape\+\_\+test.\+cpp}
\hypertarget{test_2domains_2BallShape_test_8cpp-example}{}\label{test_2domains_2BallShape_test_8cpp-example}
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{BallShape_8hpp}{medusa/bits/domains/BallShape.hpp}}>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{DomainShape_8hpp}{medusa/bits/domains/DomainShape.hpp}}>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ "{}gtest/gtest.h"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacemm}{mm}}\ \{}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallContainsBasic1D)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec1d>\ cs1(\{3\},\ 1);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ EXPECT\_TRUE(cs1.contains(\{3.5\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_TRUE(cs1.contains(\{4\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_FALSE(cs1.contains(\{1\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_FALSE(cs1.contains(\{5\}));}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallContainsBasic2D)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec2d>\ cs2(\{-\/1,\ 2\},\ 5);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ EXPECT\_TRUE(cs2.contains(\{-\/0.9,\ 1.8\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_TRUE(cs2.contains(\{-\/1.1,\ 2.2\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_TRUE(cs2.contains(\{0,\ 3\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_TRUE(cs2.contains(\{4,\ 2\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_TRUE(cs2.contains(\{4\ +\ 1e-\/13,\ 2\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_FALSE(cs2.contains(\{-\/8,\ 3\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_FALSE(cs2.contains(\{12,\ 3\}));}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallContainsBasic3D)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec3d>\ cs3(\{4,\ -\/2,\ 0\},\ 4);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ EXPECT\_TRUE(cs3.contains(\{4,\ 2,\ 0\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_TRUE(cs3.contains(\{4,\ -\/2,\ 3\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_FALSE(cs3.contains(\{10,\ 3,\ 4\}));}
\DoxyCodeLine{\ \ \ \ EXPECT\_FALSE(cs3.contains(\{-\/5,\ 3,\ 0\}));}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallDiscretizeBoundary1d)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec1d>\ b(-\/1,\ 0.4);}
\DoxyCodeLine{\ \ \ \ DomainDiscretization<Vec1d>\ d\ =\ b.discretizeBoundaryWithStep(0.1);}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ p\ =\ d.positions();}
\DoxyCodeLine{\ \ \ \ std::sort(p.begin(),\ p.end());}
\DoxyCodeLine{\ \ \ \ EXPECT\_EQ(-\/1.4,\ p[0][0]);}
\DoxyCodeLine{\ \ \ \ EXPECT\_EQ(-\/0.6,\ p[1][0]);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallDiscretizeBoundary2d)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec2d>\ c(\{-\/1,\ 2.2\},\ 1.7);}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ d\ =\ c.discretizeBoundaryWithStep(0.5);}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ p\ =\ d.positions();}
\DoxyCodeLine{\ \ \ \ std::vector<Vec2d>\ expected\ =\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{0.7,\ 2.2\},\ \{0.6311380551446455,\ 2.678945346630431\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{0.4301310058130081,\ 3.119089389674516\},\ \{0.1132632477069846,\ 3.484774276402239\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{-\/0.293794477896793,\ 3.746374392102681\},\ \{-\/0.7580647749354152,\ 3.882696451197586\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{-\/1.241935225064585,\ 3.882696451197586\},\ \{-\/1.706205522103207,\ 3.746374392102681\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{-\/2.113263247706985,\ 3.484774276402239\},\ \{-\/2.430131005813008,\ 3.119089389674516\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{-\/2.631138055144645,\ 2.678945346630431\},\ \{-\/2.7,\ 2.2\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{-\/2.631138055144646,\ 1.72105465336957\},\ \{-\/2.430131005813008,\ 1.280910610325484\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{-\/2.113263247706985,\ 0.9152257235977614\},\ \{-\/1.706205522103207,\ 0.6536256078973188\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{-\/1.241935225064585,\ 0.5173035488024147\},\ \{-\/0.7580647749354157,\ 0.5173035488024145\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{-\/0.2937944778967937,\ 0.6536256078973186\},\ \{0.113263247706985,\ 0.9152257235977614\},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \{0.4301310058130081,\ 1.280910610325485\},\ \{0.6311380551446455,\ 1.72105465336957\}\};}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ tol\ =\ 1e-\/15;}
\DoxyCodeLine{\ \ \ \ ASSERT\_EQ(expected.size(),\ p.size());}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ expected.size();}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n;\ ++i)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ EXPECT\_NEAR(expected[i][0],\ p[i][0],\ tol);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ EXPECT\_NEAR(expected[i][1],\ p[i][1],\ tol);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallDiscretizeBoundary3d)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec3d>\ domain3d(0,\ 1);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ dx\ =\ 0.05;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ tol\ =\ 0.05;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ s\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ c\ =\ 0;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ discretization3d\ =\ domain3d.discretizeBoundaryWithStep(dx);}
\DoxyCodeLine{\ \ \ \ KDTree<Vec3d>\ tree(discretization3d.positions());}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ \ <\ discretization3d.size();\ ++i)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Range<double>\ distances2\ =\ tree.query(discretization3d.pos(i),\ 2).second;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ s\ +=\ std::sqrt(distances2[1]);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ c\ +=\ 1;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ EXPECT\_NEAR(dx,\ s/c,\ dx*tol);\ \ \textcolor{comment}{//\ 5\%\ error\ tolerance}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallDiscretizeBoundaryWithDensity2d)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec2d>\ domain2d(0,\ 1);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ dx1\ =\ 0.05;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ dx2\ =\ 0.01;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ tol\ =\ 0.05;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ s1\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ c1\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ s2\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ c2\ =\ 0;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ fill\ =\ [=](\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacemm_a3cf09fb5c30d93f0cfb30d80f0b8c6cf}{Vec2d}}\&\ p)\ \{\ \textcolor{keywordflow}{return}\ (p[0]\ <\ 0.0)\ ?\ dx1\ :\ dx2;\ \};}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ discretization2d\ =\ domain2d.discretizeBoundaryWithDensity(fill);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ KDTree<Vec2d>\ tree(discretization2d.positions());}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ \ <\ discretization2d.size();\ ++i)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (discretization2d.pos(i,\ 0)\ <\ 0.0\ -\/\ tol)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Range<double>\ distances2\ =\ tree.query(discretization2d.pos(i),\ 2).second;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ s1\ +=\ std::sqrt(distances2[1]);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ c1\ +=\ 1;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (discretization2d.pos(i,\ 0)\ >\ 0.0\ +\ tol)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Range<double>\ distances2\ =\ tree.query(discretization2d.pos(i),\ 2).second;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ s2\ +=\ std::sqrt(distances2[1]);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ c2\ +=\ 1;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ EXPECT\_NEAR(dx1,\ s1/c1,\ dx1*tol);\ \ \textcolor{comment}{//\ 5\%\ error\ tolerance}}
\DoxyCodeLine{\ \ \ \ EXPECT\_NEAR(dx2,\ s2/c2,\ dx2*tol);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallDiscretizeBoundaryWithDensity3d)\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ TODO(jureslak):\ this\ test\ fails\ if\ tolerance\ is\ 0.05,\ but\ it\ shouldn't.}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Some\ generated\ points\ are\ too\ close.}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ tol\ =\ 0.1;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ s1\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ c1\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ s2\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ c2\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ dx1\ =\ 0.2;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ dx2\ =\ 0.1;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec3d>\ domain3d(0,\ 1);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ fill\ =\ [=](\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacemm_a2107b91b1d35846c8b7ea3d142498502}{Vec3d}}\&\ p)\ \{\ \textcolor{keywordflow}{return}\ (p[2]\ <\ 0.0)\ ?\ dx1\ :\ dx2;\ \};\ \ \textcolor{comment}{//\ z-\/coordinate}}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ discretization3d\ =\ domain3d.discretizeBoundaryWithDensity(fill);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Make\ kd\ tree,\ iterate\ over\ the\ points\ on\ the\ boundary\ and\ average\ the\ distance\ between\ them.}}
\DoxyCodeLine{\ \ \ \ KDTree<Vec3d>\ tree(discretization3d.positions());}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ \ <\ discretization3d.size();\ ++i)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (discretization3d.pos(i,\ 2)\ <\ 0.0\ -\/\ tol)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Range<double>\ distances2\ =\ tree.query(discretization3d.pos(i),\ 2).second;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ s1\ +=\ std::sqrt(distances2[1]);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ c1\ +=\ 1;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (discretization3d.pos(i,\ 2)\ >\ 0.0\ +\ tol)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Range<double>\ distances2\ =\ tree.query(discretization3d.pos(i),\ 2).second;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ s2\ +=\ std::sqrt(distances2[1]);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ c2\ +=\ 1;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ EXPECT\_NEAR(dx1,\ s1/c1,\ dx1*tol);\ \ \textcolor{comment}{//\ 5\%\ error\ tolerance}}
\DoxyCodeLine{\ \ \ \ EXPECT\_NEAR(dx2,\ s2/c2,\ dx2*tol);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallShapeNormalsRandom1d)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec1d>\ cd1(\{3\},\ 1);}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ discr1d\ =\ cd1.discretizeWithStep(0.1);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ :\ discr1d.boundary())\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacemm_a1fc3cec58dd3ef75ce84fa992081076d}{Vec1d}}\ n\ =\ (discr1d.pos(i)\ -\/\ cd1.center()).normalized();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ EXPECT\_DOUBLE\_EQ(n[0],\ discr1d.normal(i)[0]);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{TEST(Domains,\ BallShapeNormalsRandom2d)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec2d>\ cd2(\{-\/1,\ 2\},\ 5);}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ discr2d\ =\ cd2.discretizeWithStep(0.1);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ tol\ =\ 1e-\/15;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ :\ discr2d.boundary())\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacemm_a3cf09fb5c30d93f0cfb30d80f0b8c6cf}{Vec2d}}\ n\ =\ (discr2d.pos(i)\ -\/\ cd2.center()).normalized();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ EXPECT\_NEAR(n[0],\ discr2d.normal(i)[0],\ tol);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ EXPECT\_NEAR(n[1],\ discr2d.normal(i)[1],\ tol);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{TEST(Domains,\ BallShapeNormalsRandom3d)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec3d>\ cd3(\{4,\ -\/2,\ 0\},\ 4);}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ discr3d\ =\ cd3.discretizeBoundaryWithStep(0.2);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ tol\ =\ 1e-\/15;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ :\ discr3d.boundary())\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacemm_a2107b91b1d35846c8b7ea3d142498502}{Vec3d}}\ n\ =\ (discr3d.pos(i)\ -\/\ cd3.center()).normalized();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ EXPECT\_NEAR(n[0],\ discr3d.normal(i)[0],\ tol);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ EXPECT\_NEAR(n[1],\ discr3d.normal(i)[1],\ tol);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ EXPECT\_NEAR(n[2],\ discr3d.normal(i)[2],\ tol);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallDiscretize1d)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec1d>\ b(-\/1,\ 0.4);}
\DoxyCodeLine{\ \ \ \ DomainDiscretization<Vec1d>\ d\ =\ b.discretizeWithStep(0.1);}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ p\ =\ d.positions();}
\DoxyCodeLine{\ \ \ \ std::sort(p.begin(),\ p.end());}
\DoxyCodeLine{\ \ \ \ std::vector<double>\ expected\ =\ \{-\/1.4,\ -\/1.3,\ -\/1.2,\ -\/1.1,\ -\/1,\ -\/0.9,\ -\/0.8,\ -\/0.7,\ -\/0.6\};}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ tol\ =\ 1e-\/15;}
\DoxyCodeLine{\ \ \ \ ASSERT\_EQ(expected.size(),\ p.size());}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ expected.size();}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n;\ ++i)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ EXPECT\_NEAR(expected[i],\ p[i][0],\ tol);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallDiscretize2d)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec2d>\ b(\{-\/1,\ 2.7\},\ 0.5);}
\DoxyCodeLine{\ \ \ \ DomainDiscretization<Vec2d>\ d\ =\ b.discretizeWithStep(0.1);}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ p\ =\ d.positions();}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ p.size();}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n;\ ++i)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ i;\ ++j)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ASSERT\_GE((p[i]-\/p[j]).norm(),\ 0.095);\ \ \textcolor{comment}{//\ due\ to\ integer\ number\ of\ nodes}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallDiscretize4d)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec<double,\ 4>>\ b(0,\ 0.5);}
\DoxyCodeLine{\ \ \ \ EXPECT\_DEATH(b.discretizeWithStep(0.1),\ \textcolor{stringliteral}{"{}This\ domain\ does\ not\ support\ filling\ with\ density"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ fill\ =\ [=](\textcolor{keyword}{const}\ Vec<double,\ 4>\&)\ \{\ \textcolor{keywordflow}{return}\ 0.1;\ \};}
\DoxyCodeLine{\ \ \ \ EXPECT\_DEATH(b.discretizeBoundaryWithDensity(fill),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}This\ domain\ does\ not\ support\ filling\ with\ density"{}});}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ BallDscretizeBoundaryWithStep4d)\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{typedef}\ Vec<double,\ 4>\ vec;}
\DoxyCodeLine{\ \ \ \ BallShape<vec>\ b(0,\ 1);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ dx\ =\ 0.15;\ \ \textcolor{comment}{//\ Chosen\ to\ generate\ approximately\ 6000\ points}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ tol\ =\ 0.05;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ s\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ c\ =\ 0;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ d\ =\ b.discretizeBoundaryWithStep(dx);}
\DoxyCodeLine{\ \ \ \ KDTree<vec>\ tree(d.positions());}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ \ <\ d.size();\ ++i)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Range<double>\ distances2\ =\ tree.query(d.pos(i),\ 2).second;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ s\ +=\ std::sqrt(distances2[1]);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ c\ +=\ 1;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ EXPECT\_NEAR(dx,\ s/c,\ dx*tol);\ \ \textcolor{comment}{//\ 5\ \%\ error\ tolerance}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Domains,\ DISABLED\_BallShapeUsageExample)\ \{}
\DoxyCodeLine{\ \ \ \ BallShape<Vec2d>\ ball(\{-\/1,\ 0\},\ 7);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (ball.contains(\{0.5,\ 1.3\}))\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ do\ something}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ d\ =\ ball.discretizeWithStep(0.1);}
\DoxyCodeLine{\ \ \ \ std::cout\ <<\ ball\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ (void)\ d;\ \ \textcolor{comment}{//\ remove\ unused\ warning}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \ \textcolor{comment}{//\ namespace\ mm}}

\end{DoxyCodeInclude}
 