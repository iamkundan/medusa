<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Medusa: test/domains/NURBSShape_test.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Medusa"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config({
  TeX: {
    Macros: {
      dpar: ["\\frac{\\partial #1}{\\partial #2}", 2]
    }
  }
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://e6.ijs.si/medusa/"><img alt="Logo" src="logo_transparent.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
    <div id="projectname">Medusa
   &#160;<span id="projectnumber">1.1</span>
   </div>
   <div id="projectbrief">Coordinate Free Mehless Method implementation</div>
  </td>
   <td id="ijslogo"><a href="http://e6.ijs.si/ParallelAndDistributedSystems/"><img src="logo_ijs.png" alt="IJS_logo"></a></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,true,'search.php','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('test_2domains_2NURBSShape_test_8cpp-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test/domains/NURBSShape_test.cpp</div></div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="NURBSShape_8hpp.html">medusa/bits/domains/NURBSShape.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;gtest/gtest.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacemm.html">mm</a> {</div>
<div class="line"> </div>
<div class="line">TEST(Domains, NURBSShapeCurve1PatchConstantFill) {</div>
<div class="line">    <span class="keywordtype">int</span> p = 2;</div>
<div class="line">    Range&lt;double&gt; w({1, sqrt(3) / 2, 1, sqrt(3) / 2, 1, sqrt(3) / 2, 1, sqrt(3) / 2, 1});</div>
<div class="line">    Range&lt;double&gt; knots({0, 0, 0, <a id="a0" name="a0"></a><a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a> / 2, <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a> / 2, <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a>, <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a>, 3 * <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a> / 2,</div>
<div class="line">                         3 * <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a> / 2, 2 * <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a>, 2 * <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a>, 2 * <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a>});</div>
<div class="line">    Range&lt;Vec3d&gt; cp({<a id="a1" name="a1"></a><a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(1, 0, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(1, 1, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(0, 1, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(-1, 1, 0),</div>
<div class="line">                     <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(-1, 0, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(-1, -1, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(0, -1, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(1, -1, 0),</div>
<div class="line">                     <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(1, 0, 0)});</div>
<div class="line"> </div>
<div class="line">    NURBSPatch&lt;Vec3d, Vec1d&gt; curve(cp, w, {knots}, {p});</div>
<div class="line">    NURBSShape&lt;Vec3d, Vec1d&gt; shape({curve});</div>
<div class="line">    shape.seed(123);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> h = 0.01;</div>
<div class="line">    DomainDiscretization&lt;Vec3d&gt; domain = shape.discretizeBoundaryWithStep(h);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Calculate distances.</span></div>
<div class="line">    KDTree&lt;Vec3d&gt; tree(domain.positions());</div>
<div class="line">    Range&lt;double&gt; distances;</div>
<div class="line">    <span class="keywordtype">double</span> avg_dist = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pt : domain.positions()) {</div>
<div class="line">        distances.push_back(sqrt(tree.query(pt, 2).second[1]));</div>
<div class="line">        avg_dist += distances[distances.size() - 1];</div>
<div class="line">    }</div>
<div class="line">    avg_dist /= domain.positions().size();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> err_avg = std::abs(avg_dist - h) / h;</div>
<div class="line">    EXPECT_LT(err_avg, 0.01);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> err_min = std::abs(*std::min_element(distances.begin() + 1, distances.end() - 1) - h) / h;</div>
<div class="line">    EXPECT_LT(err_min, 0.01);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(Domains, NURBSShapeCurve1PatchFunctionFill) {</div>
<div class="line">    <span class="keywordtype">int</span> p = 2;</div>
<div class="line">    Range&lt;double&gt; w({1, sqrt(3) / 2, 1, sqrt(3) / 2, 1, sqrt(3) / 2, 1, sqrt(3) / 2, 1});</div>
<div class="line">    Range&lt;double&gt; knots({0, 0, 0, <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a> / 2, <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a> / 2, <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a>, <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a>, 3 * <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a> / 2,</div>
<div class="line">                         3 * <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a> / 2, 2 * <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a>, 2 * <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a>, 2 * <a class="code hl_variable" href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">PI</a>});</div>
<div class="line">    Range&lt;Vec3d&gt; cp({<a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(1, 0, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(1, 1, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(0, 1, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(-1, 1, 0),</div>
<div class="line">                     <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(-1, 0, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(-1, -1, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(0, -1, 0), <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(1, -1, 0),</div>
<div class="line">                     <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>(1, 0, 0)});</div>
<div class="line"> </div>
<div class="line">    NURBSPatch&lt;Vec3d, Vec1d&gt; curve(cp, w, {knots}, {p});</div>
<div class="line">    NURBSShape&lt;Vec3d, Vec1d&gt; shape({curve});</div>
<div class="line">    shape.seed(123);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> h = 0.01;</div>
<div class="line">    std::function&lt;double(<a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>)&gt; func_h = [h](<a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a> x) {</div>
<div class="line">        <span class="keywordflow">return</span> h * (pow((x(0) - 0.5), 2) + x(1) * x(1));</div>
<div class="line">    };</div>
<div class="line">    DomainDiscretization&lt;Vec3d&gt; domain = shape.discretizeBoundaryWithDensity(func_h, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Calculate distances.</span></div>
<div class="line">    KDTree&lt;Vec3d&gt; tree(domain.positions());</div>
<div class="line">    <span class="keyword">auto</span> positions = domain.positions();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; positions.size(); i++) {</div>
<div class="line">        <span class="keyword">auto</span> pt = positions[i];</div>
<div class="line">        <span class="keywordtype">double</span> dist = sqrt(tree.query(pt, 2).second[1]);</div>
<div class="line">        <span class="keywordtype">double</span> h = func_h(pt);</div>
<div class="line">        <span class="keywordtype">double</span> err = std::abs(dist - h) / h;</div>
<div class="line">        EXPECT_LT(err, 0.05);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(Domains, NURBSShapeCurveMultiplePatchFill) {</div>
<div class="line">    <span class="keywordtype">int</span> p = 3;</div>
<div class="line">    <span class="keyword">auto</span> knots = Range&lt;double&gt;{0, 0, 0, 0, 1, 1, 1, 1};</div>
<div class="line">    Range&lt;double&gt; ws{1, 1, 1, 1};</div>
<div class="line"> </div>
<div class="line">    Range&lt;Vec2d&gt; cps1{{1, 1}, {2, 3}, {4, 4}, {6, 1}};</div>
<div class="line">    Range&lt;Vec2d&gt; cps2{{1, 1}, {0, -3}, {8, -2}, {6, 1}};</div>
<div class="line"> </div>
<div class="line">    NURBSPatch&lt;Vec2d, Vec1d&gt; p1(cps1, {ws}, {knots}, {p});</div>
<div class="line">    NURBSPatch&lt;Vec2d, Vec1d&gt; p2(cps2, {ws}, {knots}, {p});</div>
<div class="line"> </div>
<div class="line">    Range&lt;NURBSPatch&lt;Vec2d, Vec1d&gt;&gt; patches{p1, p2};</div>
<div class="line">    NURBSShape&lt;Vec2d, Vec1d&gt; shape(patches);</div>
<div class="line">    shape.seed(1337);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> h = 0.01;</div>
<div class="line">    DomainDiscretization&lt;Vec2d&gt; domain = shape.discretizeBoundaryWithStep(h);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Calculate distances.</span></div>
<div class="line">    KDTree&lt;Vec2d&gt; tree(domain.positions());</div>
<div class="line">    Range&lt;double&gt; distances;</div>
<div class="line">    <span class="keywordtype">double</span> avg_dist = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pt : domain.positions()) {</div>
<div class="line">        distances.push_back(sqrt(tree.query(pt, 2).second[1]));</div>
<div class="line">        avg_dist += distances[distances.size() - 1];</div>
<div class="line">    }</div>
<div class="line">    avg_dist /= domain.positions().size();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> err_avg = std::abs(avg_dist - h) / h;</div>
<div class="line">    EXPECT_LT(err_avg, 0.01);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> err_min = std::abs(*std::min_element(distances.begin() + 1, distances.end() - 1) - h) / h;</div>
<div class="line">    EXPECT_LT(err_min, 0.01);</div>
<div class="line"> </div>
<div class="line">    EXPECT_GT(domain.size(), 1200);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(Domains, NURBSShapeSurface1PatchConstantFill) {</div>
<div class="line">    <span class="keyword">auto</span> p = std::array&lt;int, 2&gt;{1, 2};</div>
<div class="line">    <span class="keyword">auto</span> knots = std::array&lt;Range&lt;double&gt;, 2&gt;{Range&lt;double&gt;({0, 0, 1, 1}),</div>
<div class="line">              Range&lt;double&gt;({0, 0, 0, 0.25, 0.25, 0.5, 0.5, 0.75, 0.75, 1, 1, 1})};</div>
<div class="line">    Range&lt;Range&lt;Vec&lt;double, 4&gt;&gt;&gt; wcp(2);</div>
<div class="line">    <span class="keywordtype">double</span> x = 0.7071;</div>
<div class="line"> </div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(1, 0, 0, 1));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(x, x, 0, x));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(0, 1, 0, 1));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(-x, x, 0, x));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(-1, 0, 0, 1));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(-x, -x, 0, x));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(0, -1, 0, 1));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(x, -x, 0, x));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(1, 0, 0, 1));</div>
<div class="line"> </div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(1, 0, 1, 1));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(x, x, x, x));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(0, 1, 1, 1));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(-x, x, x, x));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(-1, 0, 1, 1));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(-x, -x, x, x));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(0, -1, 1, 1));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(x, -x, x, x));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(1, 0, 1, 1));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> h = 0.02;</div>
<div class="line">    NURBSPatch&lt;Vec3d, Vec2d&gt; surf(wcp, knots, p);</div>
<div class="line">    NURBSShape&lt;Vec3d, Vec2d&gt; nsh({surf});</div>
<div class="line">    nsh.seed(123);</div>
<div class="line">    DomainDiscretization&lt;Vec3d&gt; domain = nsh.discretizeBoundaryWithStep(h);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Calculate distances.</span></div>
<div class="line">    KDTree&lt;Vec3d&gt; tree(domain.positions());</div>
<div class="line">    Range&lt;double&gt; distances;</div>
<div class="line">    <span class="keywordtype">double</span> avg_dist = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pt : domain.positions()) {</div>
<div class="line">        distances.push_back(sqrt(tree.query(pt, 2).second[1]));</div>
<div class="line">        avg_dist += distances[distances.size() - 1];</div>
<div class="line">    }</div>
<div class="line">    avg_dist /= domain.positions().size();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> err_avg = std::abs(avg_dist - h) / h;</div>
<div class="line">    EXPECT_LT(err_avg, 0.05);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> err_min = std::abs(*std::min_element(distances.begin() + 1, distances.end() - 1) - h) / h;</div>
<div class="line">    EXPECT_LT(err_min, 0.2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(Domains, NURBSShapeSurface1PatchFunctionFill) {</div>
<div class="line">    <span class="keyword">auto</span> p = std::array&lt;int, 2&gt;{1, 2};</div>
<div class="line">    <span class="keyword">auto</span> knots = std::array&lt;Range&lt;double&gt;, 2&gt;{Range&lt;double&gt;({0, 0, 1, 1}),</div>
<div class="line">    Range&lt;double&gt;({0, 0, 0, 0.25, 0.25, 0.5, 0.5, 0.75, 0.75, 1, 1, 1})};</div>
<div class="line">    Range&lt;Range&lt;Vec&lt;double, 4&gt;&gt;&gt; wcp(2);</div>
<div class="line">    <span class="keywordtype">double</span> x = 0.7071;</div>
<div class="line"> </div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(1, 0, 0, 1));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(x, x, 0, x));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(0, 1, 0, 1));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(-x, x, 0, x));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(-1, 0, 0, 1));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(-x, -x, 0, x));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(0, -1, 0, 1));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(x, -x, 0, x));</div>
<div class="line">    wcp[0].push_back(Vec&lt;double, 4&gt;(1, 0, 0, 1));</div>
<div class="line"> </div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(1, 0, 1, 1));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(x, x, x, x));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(0, 1, 1, 1));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(-x, x, x, x));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(-1, 0, 1, 1));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(-x, -x, x, x));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(0, -1, 1, 1));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(x, -x, x, x));</div>
<div class="line">    wcp[1].push_back(Vec&lt;double, 4&gt;(1, 0, 1, 1));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> h = 0.02;</div>
<div class="line">    std::function&lt;double(<a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>)&gt; func_h = [h](<a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a> x) {</div>
<div class="line">        <span class="keywordflow">return</span> h * (pow((x(0) - 0.5), 2) + x(1) * x(1));</div>
<div class="line">    };</div>
<div class="line">    NURBSPatch&lt;Vec3d, Vec2d&gt; surf(wcp, knots, p);</div>
<div class="line">    NURBSShape&lt;Vec3d, Vec2d&gt; nsh({surf});</div>
<div class="line">    nsh.seed(123);</div>
<div class="line">    DomainDiscretization&lt;Vec3d&gt; domain = nsh.discretizeBoundaryWithDensity(func_h, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Calculate distances.</span></div>
<div class="line">    KDTree&lt;Vec3d&gt; tree(domain.positions());</div>
<div class="line">    <span class="keyword">auto</span> positions = domain.positions();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; positions.size(); i++) {</div>
<div class="line">        <span class="keyword">auto</span> pt = positions[i];</div>
<div class="line">        <span class="keywordtype">double</span> dist = sqrt(tree.query(pt, 2).second[1]);</div>
<div class="line">        <span class="keywordtype">double</span> h = func_h(pt);</div>
<div class="line">        <span class="keywordtype">double</span> err = std::abs(dist - h) / h;</div>
<div class="line">        EXPECT_LT(err, 0.2);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>tp_data {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> numPatches = 32;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> numVertices = 306;</div>
<div class="line">    <span class="keywordtype">int</span> teapotPatches[numPatches][16] = {</div>
<div class="line">            {  1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15,  16},</div>
<div class="line">            {  4,  17,  18,  19,   8,  20,  21,  22,  12,  23,  24,  25,  16,  26,  27,  28},</div>
<div class="line">            { 19,  29,  30,  31,  22,  32,  33,  34,  25,  35,  36,  37,  28,  38,  39,  40},</div>
<div class="line">            { 31,  41,  42,   1,  34,  43,  44,   5,  37,  45,  46,   9,  40,  47,  48,  13},</div>
<div class="line">            { 13,  14,  15,  16,  49,  50,  51,  52,  53,  54,  55,  56,  57,  58,  59,  60},</div>
<div class="line">            { 16,  26,  27,  28,  52,  61,  62,  63,  56,  64,  65,  66,  60,  67,  68,  69},</div>
<div class="line">            { 28,  38,  39,  40,  63,  70,  71,  72,  66,  73,  74,  75,  69,  76,  77,  78},</div>
<div class="line">            { 40,  47,  48,  13,  72,  79,  80,  49,  75,  81,  82,  53,  78,  83,  84,  57},</div>
<div class="line">            { 57,  58,  59,  60,  85,  86,  87,  88,  89,  90,  91,  92,  93,  94,  95,  96},</div>
<div class="line">            { 60,  67,  68,  69,  88,  97,  98,  99,  92, 100, 101, 102,  96, 103, 104, 105},</div>
<div class="line">            { 69,  76,  77,  78,  99, 106, 107, 108, 102, 109, 110, 111, 105, 112, 113, 114},</div>
<div class="line">            { 78,  83,  84,  57, 108, 115, 116,  85, 111, 117, 118,  89, 114, 119, 120,  93},</div>
<div class="line">            {121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136},</div>
<div class="line">            {124, 137, 138, 121, 128, 139, 140, 125, 132, 141, 142, 129, 136, 143, 144, 133},</div>
<div class="line">            {133, 134, 135, 136, 145, 146, 147, 148, 149, 150, 151, 152,  69, 153, 154, 155},</div>
<div class="line">            {136, 143, 144, 133, 148, 156, 157, 145, 152, 158, 159, 149, 155, 160, 161,  69},</div>
<div class="line">            {162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177},</div>
<div class="line">            {165, 178, 179, 162, 169, 180, 181, 166, 173, 182, 183, 170, 177, 184, 185, 174},</div>
<div class="line">            {174, 175, 176, 177, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197},</div>
<div class="line">            {177, 184, 185, 174, 189, 198, 199, 186, 193, 200, 201, 190, 197, 202, 203, 194},</div>
<div class="line">            {204, 204, 204, 204, 207, 208, 209, 210, 211, 211, 211, 211, 212, 213, 214, 215},</div>
<div class="line">            {204, 204, 204, 204, 210, 217, 218, 219, 211, 211, 211, 211, 215, 220, 221, 222},</div>
<div class="line">            {204, 204, 204, 204, 219, 224, 225, 226, 211, 211, 211, 211, 222, 227, 228, 229},</div>
<div class="line">            {204, 204, 204, 204, 226, 230, 231, 207, 211, 211, 211, 211, 229, 232, 233, 212},</div>
<div class="line">            {212, 213, 214, 215, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245},</div>
<div class="line">            {215, 220, 221, 222, 237, 246, 247, 248, 241, 249, 250, 251, 245, 252, 253, 254},</div>
<div class="line">            {222, 227, 228, 229, 248, 255, 256, 257, 251, 258, 259, 260, 254, 261, 262, 263},</div>
<div class="line">            {229, 232, 233, 212, 257, 264, 265, 234, 260, 266, 267, 238, 263, 268, 269, 242},</div>
<div class="line">            {270, 270, 270, 270, 279, 280, 281, 282, 275, 276, 277, 278, 271, 272, 273, 274},</div>
<div class="line">            {270, 270, 270, 270, 282, 289, 290, 291, 278, 286, 287, 288, 274, 283, 284, 285},</div>
<div class="line">            {270, 270, 270, 270, 291, 298, 299, 300, 288, 295, 296, 297, 285, 292, 293, 294},</div>
<div class="line">            {270, 270, 270, 270, 300, 305, 306, 279, 297, 303, 304, 275, 294, 301, 302, 271}</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> teapotVertices[numVertices][3] = {</div>
<div class="line">            { 1.4000,  0.0000,  2.4000},</div>
<div class="line">            { 1.4000, -0.7840,  2.4000},</div>
<div class="line">            { 0.7840, -1.4000,  2.4000},</div>
<div class="line">            { 0.0000, -1.4000,  2.4000},</div>
<div class="line">            { 1.3375,  0.0000,  2.5312},</div>
<div class="line">            { 1.3375, -0.7490,  2.5312},</div>
<div class="line">            { 0.7490, -1.3375,  2.5312},</div>
<div class="line">            { 0.0000, -1.3375,  2.5312},</div>
<div class="line">            { 1.4375,  0.0000,  2.5312},</div>
<div class="line">            { 1.4375, -0.8050,  2.5312},</div>
<div class="line">            { 0.8050, -1.4375,  2.5312},</div>
<div class="line">            { 0.0000, -1.4375,  2.5312},</div>
<div class="line">            { 1.5000,  0.0000,  2.4000},</div>
<div class="line">            { 1.5000, -0.8400,  2.4000},</div>
<div class="line">            { 0.8400, -1.5000,  2.4000},</div>
<div class="line">            { 0.0000, -1.5000,  2.4000},</div>
<div class="line">            {-0.7840, -1.4000,  2.4000},</div>
<div class="line">            {-1.4000, -0.7840,  2.4000},</div>
<div class="line">            {-1.4000,  0.0000,  2.4000},</div>
<div class="line">            {-0.7490, -1.3375,  2.5312},</div>
<div class="line">            {-1.3375, -0.7490,  2.5312},</div>
<div class="line">            {-1.3375,  0.0000,  2.5312},</div>
<div class="line">            {-0.8050, -1.4375,  2.5312},</div>
<div class="line">            {-1.4375, -0.8050,  2.5312},</div>
<div class="line">            {-1.4375,  0.0000,  2.5312},</div>
<div class="line">            {-0.8400, -1.5000,  2.4000},</div>
<div class="line">            {-1.5000, -0.8400,  2.4000},</div>
<div class="line">            {-1.5000,  0.0000,  2.4000},</div>
<div class="line">            {-1.4000,  0.7840,  2.4000},</div>
<div class="line">            {-0.7840,  1.4000,  2.4000},</div>
<div class="line">            { 0.0000,  1.4000,  2.4000},</div>
<div class="line">            {-1.3375,  0.7490,  2.5312},</div>
<div class="line">            {-0.7490,  1.3375,  2.5312},</div>
<div class="line">            { 0.0000,  1.3375,  2.5312},</div>
<div class="line">            {-1.4375,  0.8050,  2.5312},</div>
<div class="line">            {-0.8050,  1.4375,  2.5312},</div>
<div class="line">            { 0.0000,  1.4375,  2.5312},</div>
<div class="line">            {-1.5000,  0.8400,  2.4000},</div>
<div class="line">            {-0.8400,  1.5000,  2.4000},</div>
<div class="line">            { 0.0000,  1.5000,  2.4000},</div>
<div class="line">            { 0.7840,  1.4000,  2.4000},</div>
<div class="line">            { 1.4000,  0.7840,  2.4000},</div>
<div class="line">            { 0.7490,  1.3375,  2.5312},</div>
<div class="line">            { 1.3375,  0.7490,  2.5312},</div>
<div class="line">            { 0.8050,  1.4375,  2.5312},</div>
<div class="line">            { 1.4375,  0.8050,  2.5312},</div>
<div class="line">            { 0.8400,  1.5000,  2.4000},</div>
<div class="line">            { 1.5000,  0.8400,  2.4000},</div>
<div class="line">            { 1.7500,  0.0000,  1.8750},</div>
<div class="line">            { 1.7500, -0.9800,  1.8750},</div>
<div class="line">            { 0.9800, -1.7500,  1.8750},</div>
<div class="line">            { 0.0000, -1.7500,  1.8750},</div>
<div class="line">            { 2.0000,  0.0000,  1.3500},</div>
<div class="line">            { 2.0000, -1.1200,  1.3500},</div>
<div class="line">            { 1.1200, -2.0000,  1.3500},</div>
<div class="line">            { 0.0000, -2.0000,  1.3500},</div>
<div class="line">            { 2.0000,  0.0000,  0.9000},</div>
<div class="line">            { 2.0000, -1.1200,  0.9000},</div>
<div class="line">            { 1.1200, -2.0000,  0.9000},</div>
<div class="line">            { 0.0000, -2.0000,  0.9000},</div>
<div class="line">            {-0.9800, -1.7500,  1.8750},</div>
<div class="line">            {-1.7500, -0.9800,  1.8750},</div>
<div class="line">            {-1.7500,  0.0000,  1.8750},</div>
<div class="line">            {-1.1200, -2.0000,  1.3500},</div>
<div class="line">            {-2.0000, -1.1200,  1.3500},</div>
<div class="line">            {-2.0000,  0.0000,  1.3500},</div>
<div class="line">            {-1.1200, -2.0000,  0.9000},</div>
<div class="line">            {-2.0000, -1.1200,  0.9000},</div>
<div class="line">            {-2.0000,  0.0000,  0.9000},</div>
<div class="line">            {-1.7500,  0.9800,  1.8750},</div>
<div class="line">            {-0.9800,  1.7500,  1.8750},</div>
<div class="line">            { 0.0000,  1.7500,  1.8750},</div>
<div class="line">            {-2.0000,  1.1200,  1.3500},</div>
<div class="line">            {-1.1200,  2.0000,  1.3500},</div>
<div class="line">            { 0.0000,  2.0000,  1.3500},</div>
<div class="line">            {-2.0000,  1.1200,  0.9000},</div>
<div class="line">            {-1.1200,  2.0000,  0.9000},</div>
<div class="line">            { 0.0000,  2.0000,  0.9000},</div>
<div class="line">            { 0.9800,  1.7500,  1.8750},</div>
<div class="line">            { 1.7500,  0.9800,  1.8750},</div>
<div class="line">            { 1.1200,  2.0000,  1.3500},</div>
<div class="line">            { 2.0000,  1.1200,  1.3500},</div>
<div class="line">            { 1.1200,  2.0000,  0.9000},</div>
<div class="line">            { 2.0000,  1.1200,  0.9000},</div>
<div class="line">            { 2.0000,  0.0000,  0.4500},</div>
<div class="line">            { 2.0000, -1.1200,  0.4500},</div>
<div class="line">            { 1.1200, -2.0000,  0.4500},</div>
<div class="line">            { 0.0000, -2.0000,  0.4500},</div>
<div class="line">            { 1.5000,  0.0000,  0.2250},</div>
<div class="line">            { 1.5000, -0.8400,  0.2250},</div>
<div class="line">            { 0.8400, -1.5000,  0.2250},</div>
<div class="line">            { 0.0000, -1.5000,  0.2250},</div>
<div class="line">            { 1.5000,  0.0000,  0.1500},</div>
<div class="line">            { 1.5000, -0.8400,  0.1500},</div>
<div class="line">            { 0.8400, -1.5000,  0.1500},</div>
<div class="line">            { 0.0000, -1.5000,  0.1500},</div>
<div class="line">            {-1.1200, -2.0000,  0.4500},</div>
<div class="line">            {-2.0000, -1.1200,  0.4500},</div>
<div class="line">            {-2.0000,  0.0000,  0.4500},</div>
<div class="line">            {-0.8400, -1.5000,  0.2250},</div>
<div class="line">            {-1.5000, -0.8400,  0.2250},</div>
<div class="line">            {-1.5000,  0.0000,  0.2250},</div>
<div class="line">            {-0.8400, -1.5000,  0.1500},</div>
<div class="line">            {-1.5000, -0.8400,  0.1500},</div>
<div class="line">            {-1.5000,  0.0000,  0.1500},</div>
<div class="line">            {-2.0000,  1.1200,  0.4500},</div>
<div class="line">            {-1.1200,  2.0000,  0.4500},</div>
<div class="line">            { 0.0000,  2.0000,  0.4500},</div>
<div class="line">            {-1.5000,  0.8400,  0.2250},</div>
<div class="line">            {-0.8400,  1.5000,  0.2250},</div>
<div class="line">            { 0.0000,  1.5000,  0.2250},</div>
<div class="line">            {-1.5000,  0.8400,  0.1500},</div>
<div class="line">            {-0.8400,  1.5000,  0.1500},</div>
<div class="line">            { 0.0000,  1.5000,  0.1500},</div>
<div class="line">            { 1.1200,  2.0000,  0.4500},</div>
<div class="line">            { 2.0000,  1.1200,  0.4500},</div>
<div class="line">            { 0.8400,  1.5000,  0.2250},</div>
<div class="line">            { 1.5000,  0.8400,  0.2250},</div>
<div class="line">            { 0.8400,  1.5000,  0.1500},</div>
<div class="line">            { 1.5000,  0.8400,  0.1500},</div>
<div class="line">            {-1.6000,  0.0000,  2.0250},</div>
<div class="line">            {-1.6000, -0.3000,  2.0250},</div>
<div class="line">            {-1.5000, -0.3000,  2.2500},</div>
<div class="line">            {-1.5000,  0.0000,  2.2500},</div>
<div class="line">            {-2.3000,  0.0000,  2.0250},</div>
<div class="line">            {-2.3000, -0.3000,  2.0250},</div>
<div class="line">            {-2.5000, -0.3000,  2.2500},</div>
<div class="line">            {-2.5000,  0.0000,  2.2500},</div>
<div class="line">            {-2.7000,  0.0000,  2.0250},</div>
<div class="line">            {-2.7000, -0.3000,  2.0250},</div>
<div class="line">            {-3.0000, -0.3000,  2.2500},</div>
<div class="line">            {-3.0000,  0.0000,  2.2500},</div>
<div class="line">            {-2.7000,  0.0000,  1.8000},</div>
<div class="line">            {-2.7000, -0.3000,  1.8000},</div>
<div class="line">            {-3.0000, -0.3000,  1.8000},</div>
<div class="line">            {-3.0000,  0.0000,  1.8000},</div>
<div class="line">            {-1.5000,  0.3000,  2.2500},</div>
<div class="line">            {-1.6000,  0.3000,  2.0250},</div>
<div class="line">            {-2.5000,  0.3000,  2.2500},</div>
<div class="line">            {-2.3000,  0.3000,  2.0250},</div>
<div class="line">            {-3.0000,  0.3000,  2.2500},</div>
<div class="line">            {-2.7000,  0.3000,  2.0250},</div>
<div class="line">            {-3.0000,  0.3000,  1.8000},</div>
<div class="line">            {-2.7000,  0.3000,  1.8000},</div>
<div class="line">            {-2.7000,  0.0000,  1.5750},</div>
<div class="line">            {-2.7000, -0.3000,  1.5750},</div>
<div class="line">            {-3.0000, -0.3000,  1.3500},</div>
<div class="line">            {-3.0000,  0.0000,  1.3500},</div>
<div class="line">            {-2.5000,  0.0000,  1.1250},</div>
<div class="line">            {-2.5000, -0.3000,  1.1250},</div>
<div class="line">            {-2.6500, -0.3000,  0.9375},</div>
<div class="line">            {-2.6500,  0.0000,  0.9375},</div>
<div class="line">            {-2.0000, -0.3000,  0.9000},</div>
<div class="line">            {-1.9000, -0.3000,  0.6000},</div>
<div class="line">            {-1.9000,  0.0000,  0.6000},</div>
<div class="line">            {-3.0000,  0.3000,  1.3500},</div>
<div class="line">            {-2.7000,  0.3000,  1.5750},</div>
<div class="line">            {-2.6500,  0.3000,  0.9375},</div>
<div class="line">            {-2.5000,  0.3000,  1.1250},</div>
<div class="line">            {-1.9000,  0.3000,  0.6000},</div>
<div class="line">            {-2.0000,  0.3000,  0.9000},</div>
<div class="line">            { 1.7000,  0.0000,  1.4250},</div>
<div class="line">            { 1.7000, -0.6600,  1.4250},</div>
<div class="line">            { 1.7000, -0.6600,  0.6000},</div>
<div class="line">            { 1.7000,  0.0000,  0.6000},</div>
<div class="line">            { 2.6000,  0.0000,  1.4250},</div>
<div class="line">            { 2.6000, -0.6600,  1.4250},</div>
<div class="line">            { 3.1000, -0.6600,  0.8250},</div>
<div class="line">            { 3.1000,  0.0000,  0.8250},</div>
<div class="line">            { 2.3000,  0.0000,  2.1000},</div>
<div class="line">            { 2.3000, -0.2500,  2.1000},</div>
<div class="line">            { 2.4000, -0.2500,  2.0250},</div>
<div class="line">            { 2.4000,  0.0000,  2.0250},</div>
<div class="line">            { 2.7000,  0.0000,  2.4000},</div>
<div class="line">            { 2.7000, -0.2500,  2.4000},</div>
<div class="line">            { 3.3000, -0.2500,  2.4000},</div>
<div class="line">            { 3.3000,  0.0000,  2.4000},</div>
<div class="line">            { 1.7000,  0.6600,  0.6000},</div>
<div class="line">            { 1.7000,  0.6600,  1.4250},</div>
<div class="line">            { 3.1000,  0.6600,  0.8250},</div>
<div class="line">            { 2.6000,  0.6600,  1.4250},</div>
<div class="line">            { 2.4000,  0.2500,  2.0250},</div>
<div class="line">            { 2.3000,  0.2500,  2.1000},</div>
<div class="line">            { 3.3000,  0.2500,  2.4000},</div>
<div class="line">            { 2.7000,  0.2500,  2.4000},</div>
<div class="line">            { 2.8000,  0.0000,  2.4750},</div>
<div class="line">            { 2.8000, -0.2500,  2.4750},</div>
<div class="line">            { 3.5250, -0.2500,  2.4938},</div>
<div class="line">            { 3.5250,  0.0000,  2.4938},</div>
<div class="line">            { 2.9000,  0.0000,  2.4750},</div>
<div class="line">            { 2.9000, -0.1500,  2.4750},</div>
<div class="line">            { 3.4500, -0.1500,  2.5125},</div>
<div class="line">            { 3.4500,  0.0000,  2.5125},</div>
<div class="line">            { 2.8000,  0.0000,  2.4000},</div>
<div class="line">            { 2.8000, -0.1500,  2.4000},</div>
<div class="line">            { 3.2000, -0.1500,  2.4000},</div>
<div class="line">            { 3.2000,  0.0000,  2.4000},</div>
<div class="line">            { 3.5250,  0.2500,  2.4938},</div>
<div class="line">            { 2.8000,  0.2500,  2.4750},</div>
<div class="line">            { 3.4500,  0.1500,  2.5125},</div>
<div class="line">            { 2.9000,  0.1500,  2.4750},</div>
<div class="line">            { 3.2000,  0.1500,  2.4000},</div>
<div class="line">            { 2.8000,  0.1500,  2.4000},</div>
<div class="line">            { 0.0000,  0.0000,  3.1500},</div>
<div class="line">            { 0.0000, -0.0020,  3.1500},</div>
<div class="line">            { 0.0020,  0.0000,  3.1500},</div>
<div class="line">            { 0.8000,  0.0000,  3.1500},</div>
<div class="line">            { 0.8000, -0.4500,  3.1500},</div>
<div class="line">            { 0.4500, -0.8000,  3.1500},</div>
<div class="line">            { 0.0000, -0.8000,  3.1500},</div>
<div class="line">            { 0.0000,  0.0000,  2.8500},</div>
<div class="line">            { 0.2000,  0.0000,  2.7000},</div>
<div class="line">            { 0.2000, -0.1120,  2.7000},</div>
<div class="line">            { 0.1120, -0.2000,  2.7000},</div>
<div class="line">            { 0.0000, -0.2000,  2.7000},</div>
<div class="line">            {-0.0020,  0.0000,  3.1500},</div>
<div class="line">            {-0.4500, -0.8000,  3.1500},</div>
<div class="line">            {-0.8000, -0.4500,  3.1500},</div>
<div class="line">            {-0.8000,  0.0000,  3.1500},</div>
<div class="line">            {-0.1120, -0.2000,  2.7000},</div>
<div class="line">            {-0.2000, -0.1120,  2.7000},</div>
<div class="line">            {-0.2000,  0.0000,  2.7000},</div>
<div class="line">            { 0.0000,  0.0020,  3.1500},</div>
<div class="line">            {-0.8000,  0.4500,  3.1500},</div>
<div class="line">            {-0.4500,  0.8000,  3.1500},</div>
<div class="line">            { 0.0000,  0.8000,  3.1500},</div>
<div class="line">            {-0.2000,  0.1120,  2.7000},</div>
<div class="line">            {-0.1120,  0.2000,  2.7000},</div>
<div class="line">            { 0.0000,  0.2000,  2.7000},</div>
<div class="line">            { 0.4500,  0.8000,  3.1500},</div>
<div class="line">            { 0.8000,  0.4500,  3.1500},</div>
<div class="line">            { 0.1120,  0.2000,  2.7000},</div>
<div class="line">            { 0.2000,  0.1120,  2.7000},</div>
<div class="line">            { 0.4000,  0.0000,  2.5500},</div>
<div class="line">            { 0.4000, -0.2240,  2.5500},</div>
<div class="line">            { 0.2240, -0.4000,  2.5500},</div>
<div class="line">            { 0.0000, -0.4000,  2.5500},</div>
<div class="line">            { 1.3000,  0.0000,  2.5500},</div>
<div class="line">            { 1.3000, -0.7280,  2.5500},</div>
<div class="line">            { 0.7280, -1.3000,  2.5500},</div>
<div class="line">            { 0.0000, -1.3000,  2.5500},</div>
<div class="line">            { 1.3000,  0.0000,  2.4000},</div>
<div class="line">            { 1.3000, -0.7280,  2.4000},</div>
<div class="line">            { 0.7280, -1.3000,  2.4000},</div>
<div class="line">            { 0.0000, -1.3000,  2.4000},</div>
<div class="line">            {-0.2240, -0.4000,  2.5500},</div>
<div class="line">            {-0.4000, -0.2240,  2.5500},</div>
<div class="line">            {-0.4000,  0.0000,  2.5500},</div>
<div class="line">            {-0.7280, -1.3000,  2.5500},</div>
<div class="line">            {-1.3000, -0.7280,  2.5500},</div>
<div class="line">            {-1.3000,  0.0000,  2.5500},</div>
<div class="line">            {-0.7280, -1.3000,  2.4000},</div>
<div class="line">            {-1.3000, -0.7280,  2.4000},</div>
<div class="line">            {-1.3000,  0.0000,  2.4000},</div>
<div class="line">            {-0.4000,  0.2240,  2.5500},</div>
<div class="line">            {-0.2240,  0.4000,  2.5500},</div>
<div class="line">            { 0.0000,  0.4000,  2.5500},</div>
<div class="line">            {-1.3000,  0.7280,  2.5500},</div>
<div class="line">            {-0.7280,  1.3000,  2.5500},</div>
<div class="line">            { 0.0000,  1.3000,  2.5500},</div>
<div class="line">            {-1.3000,  0.7280,  2.4000},</div>
<div class="line">            {-0.7280,  1.3000,  2.4000},</div>
<div class="line">            { 0.0000,  1.3000,  2.4000},</div>
<div class="line">            { 0.2240,  0.4000,  2.5500},</div>
<div class="line">            { 0.4000,  0.2240,  2.5500},</div>
<div class="line">            { 0.7280,  1.3000,  2.5500},</div>
<div class="line">            { 1.3000,  0.7280,  2.5500},</div>
<div class="line">            { 0.7280,  1.3000,  2.4000},</div>
<div class="line">            { 1.3000,  0.7280,  2.4000},</div>
<div class="line">            { 0.0000,  0.0000,  0.0000},</div>
<div class="line">            { 1.5000,  0.0000,  0.1500},</div>
<div class="line">            { 1.5000,  0.8400,  0.1500},</div>
<div class="line">            { 0.8400,  1.5000,  0.1500},</div>
<div class="line">            { 0.0000,  1.5000,  0.1500},</div>
<div class="line">            { 1.5000,  0.0000,  0.0750},</div>
<div class="line">            { 1.5000,  0.8400,  0.0750},</div>
<div class="line">            { 0.8400,  1.5000,  0.0750},</div>
<div class="line">            { 0.0000,  1.5000,  0.0750},</div>
<div class="line">            { 1.4250,  0.0000,  0.0000},</div>
<div class="line">            { 1.4250,  0.7980,  0.0000},</div>
<div class="line">            { 0.7980,  1.4250,  0.0000},</div>
<div class="line">            { 0.0000,  1.4250,  0.0000},</div>
<div class="line">            {-0.8400,  1.5000,  0.1500},</div>
<div class="line">            {-1.5000,  0.8400,  0.1500},</div>
<div class="line">            {-1.5000,  0.0000,  0.1500},</div>
<div class="line">            {-0.8400,  1.5000,  0.0750},</div>
<div class="line">            {-1.5000,  0.8400,  0.0750},</div>
<div class="line">            {-1.5000,  0.0000,  0.0750},</div>
<div class="line">            {-0.7980,  1.4250,  0.0000},</div>
<div class="line">            {-1.4250,  0.7980,  0.0000},</div>
<div class="line">            {-1.4250,  0.0000,  0.0000},</div>
<div class="line">            {-1.5000, -0.8400,  0.1500},</div>
<div class="line">            {-0.8400, -1.5000,  0.1500},</div>
<div class="line">            { 0.0000, -1.5000,  0.1500},</div>
<div class="line">            {-1.5000, -0.8400,  0.0750},</div>
<div class="line">            {-0.8400, -1.5000,  0.0750},</div>
<div class="line">            { 0.0000, -1.5000,  0.0750},</div>
<div class="line">            {-1.4250, -0.7980,  0.0000},</div>
<div class="line">            {-0.7980, -1.4250,  0.0000},</div>
<div class="line">            { 0.0000, -1.4250,  0.0000},</div>
<div class="line">            { 0.8400, -1.5000,  0.1500},</div>
<div class="line">            { 1.5000, -0.8400,  0.1500},</div>
<div class="line">            { 0.8400, -1.5000,  0.0750},</div>
<div class="line">            { 1.5000, -0.8400,  0.0750},</div>
<div class="line">            { 0.7980, -1.4250,  0.0000},</div>
<div class="line">            { 1.4250, -0.7980,  0.0000}</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace tp_data</span></div>
<div class="line"> </div>
<div class="line">TEST(Domains, NURBSShapeSurfaceMultiplePatchFill) {</div>
<div class="line">    Range&lt;NURBSPatch&lt;Vec3d, Vec2d&gt;&gt; patches;</div>
<div class="line"> </div>
<div class="line">    std::array&lt;int, 2&gt; p{3, 3};</div>
<div class="line">    <span class="keyword">auto</span> knots = std::array&lt;Range&lt;double&gt;, 2&gt;{Range&lt;double&gt;{0, 0, 0, 0, 1, 1, 1, 1},</div>
<div class="line">                                Range&lt;double&gt;{0, 0, 0, 0, 1, 1, 1, 1}};</div>
<div class="line">    Range&lt;Range&lt;double&gt;&gt; w;</div>
<div class="line">    w.resize(4);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++) {</div>
<div class="line">            w[i].push_back(1);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tp_data::numPatches; i++) {</div>
<div class="line">        Range&lt;Range&lt;Vec3d&gt;&gt; cp;</div>
<div class="line">        cp.resize(4);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++) {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 4; k++) {</div>
<div class="line">                <span class="keyword">auto</span> v = tp_data::teapotVertices[tp_data::teapotPatches[i][4 * j + k] - 1];</div>
<div class="line">                <a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a> vert(v[0], v[1], v[2]);</div>
<div class="line">                cp[j].push_back(vert);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        patches.push_back(NURBSPatch&lt;Vec3d, Vec2d&gt;(cp, w, knots, p));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    NURBSShape&lt;Vec3d, Vec2d&gt; shape(patches);</div>
<div class="line">    shape.seed(1337).boundaryProximity(1e-11);</div>
<div class="line">    <span class="keywordtype">double</span> h = 0.05;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Fill</span></div>
<div class="line">    DomainDiscretization&lt;Vec3d&gt; domain = shape.discretizeBoundaryWithStep(h);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Calculate distances.</span></div>
<div class="line">    KDTree&lt;Vec3d&gt; tree(domain.positions());</div>
<div class="line">    Range&lt;double&gt; distances;</div>
<div class="line">    <span class="keywordtype">double</span> avg_dist = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pt : domain.positions()) {</div>
<div class="line">        distances.push_back(sqrt(tree.query(pt, 2).second[1]));</div>
<div class="line">        avg_dist += distances[distances.size() - 1];</div>
<div class="line">    }</div>
<div class="line">    avg_dist /= domain.positions().size();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> err_avg = std::abs(avg_dist - h) / h;</div>
<div class="line">    EXPECT_LT(err_avg, 0.05);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> err_min = std::abs(*std::min_element(distances.begin() + 1, distances.end() - 1) - h) / h;</div>
<div class="line">    EXPECT_LT(err_min, 0.7);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace mm</span></div>
<div class="ttc" id="aNURBSShape_8hpp_html"><div class="ttname"><a href="NURBSShape_8hpp.html">NURBSShape.hpp</a></div><div class="ttdoc">Implementation of NURBSShape class.</div></div>
<div class="ttc" id="anamespacemm_html"><div class="ttname"><a href="namespacemm.html">mm</a></div><div class="ttdoc">Root namespace for the whole library.</div><div class="ttdef"><b>Definition</b> <a href="Gaussian_8hpp_source.html#l00014">Gaussian.hpp:14</a></div></div>
<div class="ttc" id="anamespacemm_html_a2107b91b1d35846c8b7ea3d142498502"><div class="ttname"><a href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">mm::Vec3d</a></div><div class="ttdeci">Vec&lt; double, 3 &gt; Vec3d</div><div class="ttdoc">Convenience typedef for 3d vector of doubles.</div><div class="ttdef"><b>Definition</b> <a href="Vec__fwd_8hpp_source.html#l00035">Vec_fwd.hpp:35</a></div></div>
<div class="ttc" id="anamespacemm_html_add5120ca222cb67674865bb4ea92cfae"><div class="ttname"><a href="namespacemm.html#add5120ca222cb67674865bb4ea92cfae">mm::PI</a></div><div class="ttdeci">static const double PI</div><div class="ttdoc">Mathematical constant pi in double precision.</div><div class="ttdef"><b>Definition</b> <a href="Config_8hpp_source.html#l00044">Config.hpp:44</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Oct 14 2024 16:54:47 for Medusa by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
