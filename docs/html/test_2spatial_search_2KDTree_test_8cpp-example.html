<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Medusa: test/spatial_search/KDTree_test.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Medusa"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config({
  TeX: {
    Macros: {
      dpar: ["\\frac{\\partial #1}{\\partial #2}", 2]
    }
  }
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://e6.ijs.si/medusa/"><img alt="Logo" src="logo_transparent.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
    <div id="projectname">Medusa
   &#160;<span id="projectnumber">1.1</span>
   </div>
   <div id="projectbrief">Coordinate Free Mehless Method implementation</div>
  </td>
   <td id="ijslogo"><a href="http://e6.ijs.si/ParallelAndDistributedSystems/"><img src="logo_ijs.png" alt="IJS_logo"></a></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,true,'search.php','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('test_2spatial_search_2KDTree_test_8cpp-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test/spatial_search/KDTree_test.cpp</div></div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="KDTree__fwd_8hpp.html">medusa/bits/spatial_search/KDTree_fwd.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;gtest/gtest.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Vec_8hpp.html">medusa/bits/types/Vec.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacemm.html">mm</a> {</div>
<div class="line"> </div>
<div class="line">TEST(KDTree, DISABLED_UsageExample) {</div>
<div class="line">    Range&lt;Vec3d&gt; points = {{5, 4, 0}, {4, 2, 1}, {7, 6, 9}, {2, 2, 1}, {8, 0, 5},</div>
<div class="line">                           {5, 7, 0}, {3, 3, 8}, {9, 7, 3}, {2, 2, 6}, {2, 0, 6}};</div>
<div class="line">    KDTree&lt;Vec3d&gt; tree(points);  <span class="comment">// Build kd-tree</span></div>
<div class="line">    Range&lt;double&gt; distances2;  <span class="comment">// squares of distances</span></div>
<div class="line">    Range&lt;int&gt; closest;</div>
<div class="line">    <span class="comment">// Get 3 points closest to {4.1, 3, 0.5}</span></div>
<div class="line">    std::tie(closest, distances2) = tree.query({4.1, 3, 0.5}, 3);</div>
<div class="line">    <span class="comment">// closest = [1, 0, 3];</span></div>
<div class="line">    <a id="a0" name="a0"></a><a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a> p = tree.get(closest[0]);  <span class="comment">// get coordinates of the closest point</span></div>
<div class="line">    Range&lt;Vec3d&gt; closest_points = tree.get(closest);</div>
<div class="line">    <span class="comment">// distances2 = [1.26, 2.06, 5.66];</span></div>
<div class="line">    std::cout &lt;&lt; tree &lt;&lt; std::endl;</div>
<div class="line">    p = 0.0;  <span class="comment">// to not be unused.</span></div>
<div class="line">    closest_points.clear();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(KDTree, 3DQuery) {</div>
<div class="line">    Range&lt;Vec3d&gt; points = {</div>
<div class="line">            {5, 4, 0}, {4, 2, 1}, {7, 6, 9}, {2, 2, 1}, {8, 0, 5}, {5, 7, 0},</div>
<div class="line">            {3, 3, 8}, {9, 7, 3}, {2, 2, 6}, {2, 0, 6}};</div>
<div class="line">    KDTree&lt;Vec3d&gt; kd3(points);</div>
<div class="line">    EXPECT_EQ(points.size(), kd3.size());</div>
<div class="line">    EXPECT_EQ(std::vector&lt;int&gt;({1, 0}), kd3.query({4.1, 3, 0.5}, 2).first);</div>
<div class="line">    EXPECT_EQ(std::vector&lt;int&gt;({3, 1, 8}), kd3.query({2, 2, 3}, 3).first);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(KDTree, Get) {</div>
<div class="line">    Range&lt;Vec3d&gt; points = {{5, 4, 0}, {4, 2, 1}, {7, 6, 9}, {2, 2, 1}, {8, 0, 5}};</div>
<div class="line">    KDTree&lt;Vec3d&gt; kd3(points);</div>
<div class="line">    ASSERT_EQ(points.size(), kd3.size());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; kd3.size(); ++i) {</div>
<div class="line">        EXPECT_EQ(points[i], kd3.get(i));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    EXPECT_EQ(points, kd3.get({0, 1, 2, 3, 4}));  <span class="comment">// vectorized get</span></div>
<div class="line"> </div>
<div class="line">    Range&lt;int&gt; idxs = kd3.query({4.1, 3, 0.5}, 1).first;</div>
<div class="line">    ASSERT_EQ(idxs.size(), 1);</div>
<div class="line">    EXPECT_EQ(<a class="code hl_typedef" href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">Vec3d</a>({4, 2, 1}), kd3.get(idxs[0]));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(KDTree, 2DQuery) {</div>
<div class="line">    <span class="comment">// Test 2D with 50 points</span></div>
<div class="line">    Range&lt;Vec2d&gt; points = {</div>
<div class="line">            {-0.6441209666616923, 0.5850353695296744}, {-0.6201378980490286, 0.7811830957022021},</div>
<div class="line">            {-0.6784344365993658, 0.9839667035596042}, {0.044496636767509035, 0.4377470158269272},</div>
<div class="line">            {-0.5274564029904492, 0.5696927123044102}, {-0.6259567688687637, -0.7818614711722951},</div>
<div class="line">            {0.9162830614939184, 0.6489213976078669}, {0.7591192942947527, -0.3433314817836943},</div>
<div class="line">            {-0.23782320760874454, 0.1898945196158186}, {-0.5441698103664361, 0.006385132320767317},</div>
<div class="line">            {-0.3654415676489693, 0.06746853328508307}, {0.931189791692042, 0.9181001537912621},</div>
<div class="line">            {-0.3427312891982608, -0.6826010311723985}, {0.891723271821818, -0.8508989951879877},</div>
<div class="line">            {0.11394616056891804, 0.84630479540056}, {-0.5223541537898675, -0.026438581866889965},</div>
<div class="line">            {0.425710227280224, 0.232320814224092}, {-0.12153165386201059, -0.09554948988436873},</div>
<div class="line">            {-0.5360668060424465, 0.8346421613694428}, {-0.48815760323401425, -0.47632741760208863},</div>
<div class="line">            {-0.7355755648085145, 0.021559400675411178}, {0.16684622124842763, -0.5180297967184262},</div>
<div class="line">            {0.2750341401977108, 0.14027191172883025}, {0.6550291085853586, -0.0906298270828052},</div>
<div class="line">            {0.11672354315833089, 0.6864647718719339}, {0.4319012792644372, -0.5056121884571734},</div>
<div class="line">            {-0.3111112525746833, 0.4841999490074793}, {0.9537933710310402, -0.4121810950684375},</div>
<div class="line">            {-0.13430435085483827, -0.7063126623794711}, {0.8509710074195942, 0.4342793339962312},</div>
<div class="line">            {0.8387012530238107, -0.8797447958759539}, {-0.788610725923649, -0.28402465290256296},</div>
<div class="line">            {0.3781644510827291, -0.19185822357265714}, {0.3675280148118516, -0.19959444568922202},</div>
<div class="line">            {0.5441631640348303, 0.9923042351466602}, {0.4379307570126687, -0.7976305308639227},</div>
<div class="line">            {0.6192156716466921, 0.5095818625700927}, {0.4538538344127916, 0.24132983301916466},</div>
<div class="line">            {-0.920957301103486, 0.7946521172232996}, {-0.4620339775822764, -0.6725241136453264},</div>
<div class="line">            {0.6164340529959673, -0.370457261186975}, {0.6353232887100764, -0.4527336246027056},</div>
<div class="line">            {0.5129962829311199, 0.2576340035951956}, {-0.3355508932427227, 0.20820573070479842},</div>
<div class="line">            {-0.03557537269552791, 0.801250103966441}, {-0.6249260602423057, 0.01901038540320088},</div>
<div class="line">            {0.9052024446464844, -0.37370939241714884}, {-0.08417808324593734, -0.4918951358215899},</div>
<div class="line">            {-0.7408521674604813, -0.38351394950328266}, {0.8804020099004968, 0.2246660525735673}};</div>
<div class="line">    <span class="keywordtype">int</span> rs;</div>
<div class="line">    KDTree&lt;Vec2d&gt; kd2({{-1, -1}, {-1, 0}, {-4, 4}});</div>
<div class="line">    kd2.reset(points);</div>
<div class="line"> </div>
<div class="line">    EXPECT_EQ(points.size(), kd2.size());</div>
<div class="line">    EXPECT_EQ(2, kd2.query(points[33], 0.05).first.size());</div>
<div class="line">    EXPECT_EQ(2, kd2.query(points[33], 0.05).first.size());</div>
<div class="line">    <span class="keyword">auto</span> result = kd2.query(points[33], 3);</div>
<div class="line">    EXPECT_EQ(std::vector&lt;int&gt;({33, 32, 40}), result.first);</div>
<div class="line">    rs = result.first.size();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; rs; i++) {</div>
<div class="line">        EXPECT_DOUBLE_EQ(</div>
<div class="line">                (points[33] - points[result.first[i]]).squaredNorm(), result.second[i]);</div>
<div class="line">        EXPECT_LE(result.second[i], result.second[rs-1]);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    EXPECT_EQ(2, kd2.query(points[17], 0.09).first.size());</div>
<div class="line">    result = kd2.query(points[17], 3);</div>
<div class="line">    EXPECT_EQ(std::vector&lt;int&gt;({17, 10, 8}), result.first);</div>
<div class="line">    rs = result.first.size();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; rs; i++) {</div>
<div class="line">        EXPECT_DOUBLE_EQ(</div>
<div class="line">                (points[17] - points[result.first[i]]).squaredNorm(), result.second[i]);</div>
<div class="line">        EXPECT_LE(result.second[i], result.second[rs-1]);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    EXPECT_EQ(4, kd2.query({0., 0}, 0.14).first.size());</div>
<div class="line">    result = kd2.query({0., 0}, 5);</div>
<div class="line">    EXPECT_EQ(std::vector&lt;int&gt;({17, 8, 22, 10, 43}), result.first);</div>
<div class="line">    rs = result.first.size();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; rs; i++) {</div>
<div class="line">        EXPECT_DOUBLE_EQ(</div>
<div class="line">                (<a id="a1" name="a1"></a><a class="code hl_typedef" href="namespacemm.html#a3cf09fb5c30d93f0cfb30d80f0b8c6cf">Vec2d</a>({0, 0}) - points[result.first[i]]).squaredNorm(), result.second[i]);</div>
<div class="line">        EXPECT_LE(result.second[i], result.second[rs-1]);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    EXPECT_EQ(3, kd2.query({0.7, 0.7}, 0.101).first.size());</div>
<div class="line">    result = kd2.query({0.7, 0.7}, 5);</div>
<div class="line">    EXPECT_EQ(std::vector&lt;int&gt;({36, 6, 29, 11, 34}), result.first);</div>
<div class="line">    rs = result.first.size();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; rs; i++) {</div>
<div class="line">        EXPECT_DOUBLE_EQ(</div>
<div class="line">                (<a class="code hl_typedef" href="namespacemm.html#a3cf09fb5c30d93f0cfb30d80f0b8c6cf">Vec2d</a>({0.7, 0.7}) - points[result.first[i]]).squaredNorm(), result.second[i]);</div>
<div class="line">        EXPECT_LE(result.second[i], result.second[rs-1]);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(KDTree, DeathTests) {</div>
<div class="line">    Range&lt;Vec2d&gt; points({{1.3, 2.4}});</div>
<div class="line">    KDTree&lt;Vec2d&gt; kd(points);</div>
<div class="line">    EXPECT_DEATH(kd.query(0., 3), <span class="stringliteral">&quot;There were not enough points in the tree, you requested 3 &quot;</span></div>
<div class="line">                                  <span class="stringliteral">&quot;points, the tree only contains 1 points.&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace mm</span></div>
<div class="ttc" id="aKDTree__fwd_8hpp_html"><div class="ttname"><a href="KDTree__fwd_8hpp.html">KDTree_fwd.hpp</a></div><div class="ttdoc">Declaration of KDTree.</div></div>
<div class="ttc" id="aVec_8hpp_html"><div class="ttname"><a href="Vec_8hpp.html">Vec.hpp</a></div><div class="ttdoc">Implemetations for Vec.</div></div>
<div class="ttc" id="anamespacemm_html"><div class="ttname"><a href="namespacemm.html">mm</a></div><div class="ttdoc">Root namespace for the whole library.</div><div class="ttdef"><b>Definition</b> <a href="Gaussian_8hpp_source.html#l00014">Gaussian.hpp:14</a></div></div>
<div class="ttc" id="anamespacemm_html_a2107b91b1d35846c8b7ea3d142498502"><div class="ttname"><a href="namespacemm.html#a2107b91b1d35846c8b7ea3d142498502">mm::Vec3d</a></div><div class="ttdeci">Vec&lt; double, 3 &gt; Vec3d</div><div class="ttdoc">Convenience typedef for 3d vector of doubles.</div><div class="ttdef"><b>Definition</b> <a href="Vec__fwd_8hpp_source.html#l00035">Vec_fwd.hpp:35</a></div></div>
<div class="ttc" id="anamespacemm_html_a3cf09fb5c30d93f0cfb30d80f0b8c6cf"><div class="ttname"><a href="namespacemm.html#a3cf09fb5c30d93f0cfb30d80f0b8c6cf">mm::Vec2d</a></div><div class="ttdeci">Vec&lt; double, 2 &gt; Vec2d</div><div class="ttdoc">Convenience typedef for 2d vector of doubles.</div><div class="ttdef"><b>Definition</b> <a href="Vec__fwd_8hpp_source.html#l00034">Vec_fwd.hpp:34</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Oct 14 2024 16:54:47 for Medusa by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
